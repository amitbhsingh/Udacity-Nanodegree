"use strict";!function(i){var r,l,a,o,s,c,u,t=1,E=11e3,L=!1,S={ERROR:"error",HAS_RESULTS:"has_results",LOADING:"loading",NO_RESULTS:"no_results",SLOW:"slow"},n={END_SPACES:/^\s+|\s+$/g,MULTIPLE_SPACES:/\s+/g,FORBIDDEN_CHARS:/[?=/\\]/g},d={DESKTOP_SEARCH_BTN:"#fullscreen-search-desktop-search-btn",DESKTOP_SEARCH:"#fullscreen-search-term",MOBILE_SEARCH:"#fullscreen-search-mobile-term",LOADING_LEGACY:"#fullscreen-search-desktop-loading",LOADING:".js-search-results__loading",VIEW_ALL_LINK_LEGACY:"#fullscreen-search-results-view-all",VIEW_ALL_LINK:".js-search-results__view-all-link"},_={ENTER:13},m={},T=0;function f(e,t){var n=function(e){if(e)return e.every(function(e){return 0===e.data.length})}(t),r=nunjucks.render(a,{results:t,source:"search",status:t&&n?S.NO_RESULTS:e});l.innerHTML=r;var o=i(d.DESKTOP_SEARCH).val();o||(o=i(d.MOBILE_SEARCH).val()),function(e){i(c).attr("href",RottenTomatoes.link.webSearchResults({},{search:e}))}(o),e===S.LOADING||e===S.NO_RESULTS||e===S.ERROR?i(c).css("display","none"):e===S.HAS_RESULTS&&i(c).css("display","block")}function v(n){T--;var e=n&&Object.keys(n).some(function(e){var t=n[e];if(t instanceof Array)return t.length});if(n&&e){var t=function(e){var t=e.movies||[],n=e.tvSeries||[],r=e.actors||[],o=e.franchises||[],i=e.critics||[];return[{title:"Franchises",type:"franchises",data:o.map(function(e){return{type:"franchise",title:e.title,url:window.location.origin+e.url,line1:e.title,image:e.image}})},{title:"Movies",type:"movies",data:t.map(function(e){return{type:"movie",title:e.name,url:window.location.origin+e.url,line1:e.name,line2:e.subline&&", "===e.subline.substr(-2)?e.subline.slice(0,-2):"",yearLine:e.year?"("+e.year+")":"",image:e.image}})},{title:"TV Series",type:"tvSeries",data:n.map(function(e){return{type:"tv",title:e.title,url:window.location.origin+e.url,line1:e.title,line2:e.subline,yearLine:e.startYear?"("+e.startYear+"-"+(e.endYear||" ")+")":"",image:e.image}})},{title:"Celebrities",type:"actors",data:r.map(function(e){return{type:"celebrity",title:e.name,url:window.location.origin+e.url,line1:e.name,image:e.image}})},{title:"Top Movies Now",type:"critics",data:i.map(function(e){return{type:"critics",title:e.name,url:window.location.origin+e.url,line1:e.name,image:e.image}})}]}(n);!function(e,t){m[e]=t}(o,t),f(S.HAS_RESULTS,t)}else 0===T&&f(n.error?S.ERROR:S.NO_RESULTS,null)}function R(){0===--T&&f(S.SLOW,null)}function y(e){f(S.LOADING,null);var t=RottenTomatoes.link.napiSearchAllCategories(),n={limit:5,query:e};T++,i.ajax({url:t,data:n,timeout:E,xhrFields:{withCredentials:!0},success:v,error:R})}function O(){var e=function(e){return m[e]||!1}(o=r.value.replace(n.FORBIDDEN_CHARS," ").replace(n.END_SPACES,"").replace(n.MULTIPLE_SPACES," "));return o.length<t?(l.value&&0!==l.value.length&&(l.innerHTML=""),void(0!==i(s).length&&i(c).css("display","none"))):e?f(S.HAS_RESULTS,e):void y(o)}function A(e){e.keyCode===_.ENTER&&(e.preventDefault(),e.target.value&&""!==e.target.value&&(window.location=window.location.origin+RottenTomatoes.link.webSearchResults({},{search:e.target.value})))}function h(e){e.preventDefault();var t=i(d.DESKTOP_SEARCH).val();if(!t)return!1;window.location=window.location.origin+RottenTomatoes.link.webSearchResults({},{search:t})}RottenTomatoes.searchAutocomplete={init:function(e,t,n){e!==r&&(r?(r.removeEventListener("input",u),r.removeEventListener("fd.clearable.clear",O),r.removeEventListener("keypress",A)):i(d.DESKTOP_SEARCH_BTN).on("click",h),r=e,l=t,a=n,u=RottenTomatoes.util.debounce(500,r,{},O),r.addEventListener("input",u),r.addEventListener("fd.clearable.clear",O),r.addEventListener("keypress",A),L=RottenTomatoes.context.layout&&"mptd"===RottenTomatoes.context.layout.name,s=L?d.LOADING:d.LOADING_LEGACY,c=L?d.VIEW_ALL_LINK:d.VIEW_ALL_LINK_LEGACY)}}}(jQuery),function(){var S,n,r=8,o=11e3,i="/assets/pizza-pie/images/poster_default.c8c896e70c3.gif",d={DESKTOP_WRAP:"#fullscreen-search-desktop-root",DESKTOP_TERM:"#fullscreen-search-term",DESKTOP_RESULTS:"#fullscreen-search-results-container",LEGACY_MOBILE_MODAL:"#fullscreen-search-root",LEGACY_MOBILE_CLOSE_BTN:"#fullscreen-search-close-btn",LEGACY_MOBILE_CLEAR_BTN:"#fullscreen-search-clear-btn",LEGACY_MOBILE_SUBMIT_BTN:"#fullscreen-search-search-btn",LEGACY_MOBILE_RESULTS:"#fullscreen-search-results-container",MOBILE_SHOW_BTN_FULLSCREEN:"#fullscreen-search-show-btn",MOBILE_TERM:"#fullscreen-search-mobile-term",MOBILE_RESULTS:"#fullscreen-search-mobile-results",MOBILE_CLEAR_BTN:"#fullscreen-search-mobile-clear-btn",MOBILE_SUBMIT_BTN:"#fullscreen-search-mobile-submit-btn",LOGO:"#masthead-logo"},_={RESULTS:"_searchResults",MOBILE_MODAL:"_mobileSearch",LEGACY_RESULTS:"_fullscreenSearchResults"},E={ESC:27};function m(e){if(window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")),!Array.isArray(e))return[];var t=e.map(function(e){return{type:"topMovie",url:window.location.origin+e.url,image:e.posterUrl||i,line1:e.title,line2:(e.actors||[]).slice(0,2).map(function(e){return e.name}).join(", "),yearLine:e.year?"("+e.year+")":null}});return t.length>r?t.slice(0,r):t}function T(t){if(n)return t(n);var e=RottenTomatoes.link.napiSearchTopMoviesDefaultList();RottenTomatoes.xhr.ajax({method:"GET",url:e,data:{},timeout:o,xhrFields:{withCredentials:!0},success:function(e){t(n=e)}})}function l(e){var t,r,n=!0,o=e?_.RESULTS:_.LEGACY_RESULTS;function i(e){var t=m(e),n=nunjucks.render(o,{results:t,source:"suggested"});r.innerHTML=n,S=n}function l(e){e.stopPropagation()}function a(){t.addEventListener("click",l),document.addEventListener("click",u),n?(n=!1,T(i)):r.style.display="block",RottenTomatoes.searchAutocomplete.init(t,r,o)}function s(e){e.keyCode===E.ESC?(t.value="",r.style.display="none",c()):(r.style.display="block",""===t.value&&(r.innerHTML=S))}function c(){t.removeEventListener("click",l),document.removeEventListener("click",u)}function u(){r.style.display="none",c()}t=document.querySelector(d.DESKTOP_TERM),r=document.querySelector(d.DESKTOP_RESULTS),t.addEventListener("focus",a),t.addEventListener("keyup",s)}!function(){var e=document.querySelector(d.MOBILE_SHOW_BTN_FULLSCREEN),t=RottenTomatoes.context.layout&&"mptd"===RottenTomatoes.context.layout.name;if(e){var n=function(e){var l,a,s=!0;function c(){""===l.value&&(a.innerHTML=S)}function u(){document.querySelector(d.LEGACY_MOBILE_MODAL).style.display="none"}function E(){l.value="",a.innerHTML="",l.focus()}function L(){l.value&&(window.location=window.location.origin+RottenTomatoes.link.webSearchResults({},{search:l.value}))}function t(o){var e={logoSource:document.querySelector(d.LOGO).getAttribute("src")},t=nunjucks.render(_.MOBILE_MODAL,e);RottenTomatoes.modal.show(t,function(e){l=document.querySelector(d.MOBILE_TERM),a=document.querySelector(d.MOBILE_RESULTS);var t=nunjucks.render(_.RESULTS,{results:m(o),source:"suggested"});a.innerHTML=t,S=t,RottenTomatoes.searchAutocomplete.init(l,a,_.RESULTS);var n=document.querySelector(d.MOBILE_CLEAR_BTN);n&&n.addEventListener("click",E);var r=document.querySelector(d.MOBILE_SUBMIT_BTN);r&&r.addEventListener("click",L),l.addEventListener("keyup",c),l.focus()})}function n(e){var t=document.querySelector(d.LEGACY_MOBILE_MODAL);l=t.querySelector(d.MOBILE_TERM),a=t.querySelector(d.LEGACY_MOBILE_RESULTS);var n=nunjucks.render(_.LEGACY_RESULTS,{results:m(e),source:"suggested"});if(a.innerHTML=n,S=n,a.style.display="block",t.style.display="block",RottenTomatoes.searchAutocomplete.init(l,a,_.LEGACY_RESULTS),s){s=!1;var r=t.querySelector(d.LEGACY_MOBILE_CLOSE_BTN);r&&r.addEventListener("click",u);var o=t.querySelector(d.LEGACY_MOBILE_CLEAR_BTN);o&&o.addEventListener("click",E);var i=t.querySelector(d.LEGACY_MOBILE_SUBMIT_BTN);i&&i.addEventListener("click",L),l.addEventListener("keyup",c)}}return{show:function(){T(e?t:n)}}}(t);e.addEventListener("click",n.show)}l(t)}()}();